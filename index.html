<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人药品管理系统</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<div id="app-container">
    <h1>个人药品管理系统</h1>
    
    <!-- 数据统计面板 -->
    <div class="stats-section">
        <h2>数据统计</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="totalDrugs">0</div>
                <div class="stat-label">药品种类</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalStock">0</div>
                <div class="stat-label">总库存量</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalValue">0</div>
                <div class="stat-label">库存总值(元)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="lowStockCount">0</div>
                <div class="stat-label">低库存药品</div>
            </div>
        </div>
    </div>
    
    <div class="grid-container">
        <!-- 左侧：表单区域 -->
        <div class="form-section">
            <h2>新增药品</h2>
            <form id="addDrugForm">
                <input type="text" id="drugName" placeholder="药品名称 (必填)" required autocomplete="off">
                <input type="number" id="drugPrice" placeholder="参考单价 (必填)" step="0.01" required autocomplete="off">
                <input type="text" id="drugSpec" placeholder="规格 (选填)" autocomplete="off">
                <input type="text" id="drugManu" placeholder="生产厂家 (选填)" autocomplete="off">
                <button type="submit">添加药品</button>
            </form>
            
            <h2 style="margin-top: 30px;">出入库操作</h2>
            <form id="stockOpForm">
                <select id="opDrugSelect" required>
                    <option value="">--请选择药品--</option>
                </select>
                <div>
                    <label><input type="radio" name="opType" value="IN" checked> 入库</label>
                    <label><input type="radio" name="opType" value="OUT"> 出库</label>
                </div>
                <input type="number" id="opQuantity" placeholder="数量 (必填)" required min="1" autocomplete="off">
                <input type="number" id="opPrice" placeholder="本次入库单价 (必填)" step="0.01" required autocomplete="off">
                <button type="submit">执行操作</button>
            </form>
        </div>
        
        <!-- 右侧：库存表格 -->
        <div class="table-section">
            <h2>库存总览</h2>
            <input type="text" id="searchInput" class="search-bar" placeholder="搜索药品名称或厂家..." autocomplete="off">
            <table id="drugTable">
                <thead>
                    <tr>
                        <th>名称</th>
                        <th>规格</th>
                        <th>厂家</th>
                        <th>当前库存</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="drugTableBody"></tbody>
            </table>
        </div>
    </div>
    
    <!-- 出入库流水 -->
    <div class="table-section" style="margin-top: 30px;">
        <h2>出入库流水</h2>
        <table id="recordsTable">
            <thead>
                <tr>
                    <th>时间</th>
                    <th>药品名称</th>
                    <th>操作类型</th>
                    <th>数量</th>
                    <th>单价</th>
                </tr>
            </thead>
            <tbody id="recordsTableBody"></tbody>
        </table>
    </div>
    
    <!-- 数据管理 -->
    <div class="data-management">
        <button id="exportDataBtn" class="btn-secondary">导出数据</button>
        <input type="file" id="importDataInput" accept=".json" style="display: none;">
        <button id="importDataBtn" class="btn-secondary">导入数据</button>
        <button id="dataRecoveryBtn" class="btn-secondary">数据恢复</button>
        <a href="analytics.html" target="_blank" class="btn-secondary" style="text-decoration: none; display: inline-block; padding: 10px 15px; background-color: #28a745; color: white; border-radius: 4px; margin-left: 10px;">数据分析</a>
    </div>
</div>

<!-- 数据恢复模态框 -->
<div id="recoveryModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>数据恢复</h3>
            <span class="modal-close" onclick="closeRecoveryModal()">&times;</span>
        </div>
        <div>
            <p>扫描并预览浏览器中的药品管理数据</p>
            <button onclick="scanStorageData()">扫描数据</button>
            <div id="scanStatus" style="margin: 15px 0;"></div>
            
            <!-- 数据列表 -->
            <div id="recoveryDataTable" style="display: none; margin-top: 20px;">
                <h4>发现的数据</h4>
                <table>
                    <thead>
                        <tr>
                            <th>存储键</th>
                            <th>类型</th>
                            <th>药品数量</th>
                            <th>记录数量</th>
                            <th>大小</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="recoveryDataTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 数据预览模态框 -->
<div id="dataPreviewModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 id="previewTitle">数据预览</h3>
            <span class="modal-close" onclick="closePreviewModal()">&times;</span>
        </div>
        <div id="previewData" style="white-space: pre-wrap; font-family: 'Courier New', monospace; background: #f8f9fa; padding: 15px; border-radius: 4px; border: 1px solid #e9ecef; max-height: 400px; overflow-y: auto; margin-bottom: 15px;"></div>
        <div class="modal-buttons">
            <button id="previewRestoreBtn" class="btn">恢复此数据</button>
            <button onclick="closePreviewModal()" class="btn-secondary">取消</button>
        </div>
    </div>
</div>

<!-- 引入JavaScript模块 -->
<script src="assets/js/data-logic.js"></script>
<script src="assets/js/ui-utils.js"></script>
<script src="assets/js/main.js"></script>
</body>
</html>
